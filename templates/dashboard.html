{% extends 'base.html' %}
{% block title %}Dashboard - Attendance System{% endblock %}
{% block content %}
<h2 class="text-center mb-4"><i class="fas fa-tachometer-alt"></i> Dashboard</h2>
<div class="row mobile-stack">
    <div class="col-12 col-md-4">
        <div class="card text-center h-100">
            <div class="card-body d-flex flex-column">
                <i class="fas fa-users fa-3x text-primary mb-3"></i>
                <h5 class="card-title">Manage Students</h5>
                <p class="card-text flex-grow-1">Add, edit, and enroll students.</p>
                <a href="/students" class="btn btn-primary mt-auto"><i class="fas fa-arrow-right"></i> Go</a>
            </div>
        </div>
    </div>
    <div class="col-12 col-md-4">
        <div class="card text-center h-100">
            <div class="card-body d-flex flex-column">
                <i class="fas fa-calendar-check fa-3x text-success mb-3"></i>
                <h5 class="card-title">View Attendance</h5>
                <p class="card-text flex-grow-1">Check records and export data.</p>
                <a href="/attendance" class="btn btn-success mt-auto"><i class="fas fa-arrow-right"></i> Go</a>
            </div>
        </div>
    </div>
    <div class="col-12 col-md-4">
    <div class="card text-center h-100">
        <div class="card-body d-flex flex-column">
            <i class="fas fa-play-circle fa-3x text-warning mb-3"></i>
            <h5 class="card-title">Kiosk Mode</h5>
            <p class="card-text flex-grow-1">Launch face recognition mode.</p>
            {% if kiosk_active %}
            <button onclick="stopKiosk()" class="btn btn-danger mt-auto"><i class="fas fa-stop"></i> Stop Kiosk</button>
            <small class="text-muted">Active by: {{ kiosk_admin }}</small>
            {% else %}
            <button onclick="openKioskDisplay()" class="btn btn-warning mt-auto"><i class="fas fa-play"></i> Start Kiosk</button>
            {% endif %}
        </div>
    </div>
</div>
</div>
</div>
<div class="row mt-4">
    <div class="col-12">
        <div class="alert alert-info mobile-center">
            <strong><i class="fas fa-users"></i> Total Students:</strong> {{ total_students or 0 }} | 
            <strong><i class="fas fa-calendar-check"></i> Today's Attendance:</strong> {{ todays_count or 0 }}
        </div>
    </div>
</div>
<div class="row mt-4">
    <div class="col-12">
        <button class="btn btn-info mobile-full" type="button" data-bs-toggle="collapse" data-bs-target="#qrSection">
            <i class="fas fa-qrcode"></i> Access QR Code
        </button>
        <div class="collapse mt-3" id="qrSection">
            <div class="card">
                <div class="card-body text-center">
                    <p>Scan to access remotely.</p>
                    <img src="/qr_code" alt="QR Code" class="img-fluid" style="max-width: 200px;">
                    <br><a href="/qr_code" download="attendance_qr.png" class="btn btn-secondary mt-2"><i class="fas fa-download"></i> Download</a>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    function openKioskDisplay() {
        fetch('/kiosk_status', { 
            method: 'POST',
            headers: {'Content-Type': 'application/x-www-form-urlencoded'}
        })
        .then(response => response.json())
        .then(data => {
            alert('Kiosk started! The kiosk device will automatically activate.');
            location.reload();
        })
        .catch(err => alert('Error: ' + err));
    }
    
    function stopKiosk() {
        fetch('/kiosk_status', { 
            method: 'DELETE',
            headers: {'Content-Type': 'application/x-www-form-urlencoded'}
        })
        .then(response => response.json())
        .then(data => {
            alert('Kiosk stopped!');
            location.reload();
        })
        .catch(err => alert('Error: ' + err));
    }
</script>
{% endblock %}

